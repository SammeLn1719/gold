{% extends 'base.html' %}
{% load static %}

{% block title %}–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤{% if selected_category %} - {{ selected_category }}{% endif %}{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>üõçÔ∏è {% if current_category %}{{ current_category.name }}{% else %}–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤{% endif %}</h1>
        <p class="products-count">–ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: <strong>{{ total_products }}</strong></p>
    </div>

    <div class="filters-section">
        <div class="search-box">
            <form method="get" class="search-form">
                <input 
                    type="text" 
                    name="search" 
                    class="search-input" 
                    placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é..." 
                    value="{{ search_query }}"
                >
                <button type="submit" class="btn-search">üîç –ù–∞–π—Ç–∏</button>
                {% if search_query %}
                    {% if current_category %}
                        <a href="{% url 'category:category_products' current_category.slug %}" class="btn-clear">‚úï –°–±—Ä–æ—Å–∏—Ç—å</a>
                    {% else %}
                        <a href="{% url 'category:product_list' %}" class="btn-clear">‚úï –°–±—Ä–æ—Å–∏—Ç—å</a>
                    {% endif %}
                {% endif %}
            </form>
        </div>
    </div>

    <div class="main-content">
        <aside class="sidebar">
            <h3>üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
            <ul class="categories-list">
                <li class="category-item">
                    <a href="{% url 'category:product_list' %}{% if search_query %}?search={{ search_query }}{% endif %}" 
                       class="category-link {% if not selected_category %}active{% endif %}">
                        –í—Å–µ —Ç–æ–≤–∞—Ä—ã
                    </a>
                </li>
                {% for category in categories %}
                <li class="category-item">
                    <a href="{% url 'category:category_products' category.slug %}{% if search_query %}?search={{ search_query }}{% endif %}" 
                       class="category-link {% if selected_category == category.slug %}active{% endif %}">
                        {{ category.name }}
                    </a>
                </li>
                {% endfor %}
            </ul>
        </aside>

        <div class="products-container">
            {% if products %}
                <div class="products-grid">
                    {% for product in products %}
                    <div class="product-card">
                        <div class="product-image-container">
                            <img src="{{ product.get_image_url }}" 
                                 alt="{{ product.name }}" 
                                 class="product-image">
                        </div>
                        
                        <div class="product-info">
                            <span class="product-category-badge">{{ product.category.name }}</span>
                            <h3 class="product-name">{{ product.name }}</h3>
                            
                            <div class="product-footer">
                                <div class="product-price">{{ product.price|floatformat:2 }} ‚ÇΩ</div>
                                <a href="{{ product.get_absolute_url }}" class="btn-detail">
                                    –ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                {% if is_paginated %}
                <nav class="pagination">
                    {% if page_obj.has_previous %}
                        <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}">
                            ¬´ –ü–µ—Ä–≤–∞—è
                        </a>
                        <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">
                            ‚Äπ –ù–∞–∑–∞–¥
                        </a>
                    {% else %}
                        <span class="disabled">¬´ –ü–µ—Ä–≤–∞—è</span>
                        <span class="disabled">‚Äπ –ù–∞–∑–∞–¥</span>
                    {% endif %}

                    <span class="current">
                        –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
                    </span>

                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">
                            –í–ø–µ—Ä–µ–¥ ‚Ä∫
                        </a>
                        <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}">
                            –ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª
                        </a>
                    {% else %}
                        <span class="disabled">–í–ø–µ—Ä–µ–¥ ‚Ä∫</span>
                        <span class="disabled">–ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª</span>
                    {% endif %}
                </nav>
                {% endif %}
            {% else %}
                <div class="empty-state">
                    <div class="empty-state-icon">üì¶</div>
                    <h2>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h2>
                    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</p>
                    <a href="{% url 'category:product_list' %}" class="btn-clear" style="margin-top: 20px;">
                        ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–∞—Ç–∞–ª–æ–≥—É
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

